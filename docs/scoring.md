# Scoring

_Deciding "how well" a player has performed in a round_

The scoring system is designed to account for several components of the
challenge:

- Return on Investment
- Diversification of Portfolio
- Client satisfaction
- Risk-adjusted returns (Sharpe / Sortino blend)
- Drawdown resilience (lower maximum drawdown => higher score)
- Random additive factor (stochastic noise term)

The overall number of points allocated are a weighted sum of the above. A new
drawdown term penalizes portfolios that experience deep peak-to-trough losses.

$$
	ext{points} = \alpha\cdot \text{RoI} + \beta\cdot\text{Diversification} +
\gamma\cdot\text{Client Satisfaction} + \delta\cdot\text{RiskAdj} + \epsilon\cdot\text{DrawdownScore} + \zeta\cdot\text{RandomNoise}
$$

## Return on Investment

$$
\text{RoI} = \frac{\text{Profit}}{\text{Budget}}
$$

## Diversification of Portfolio

$$
\text{Diversification} = \log{\left(1 + \text{n. stocks}\right)} \cdot\frac{1}{1 +
\text{MSE
of Stocks} \cdot \text{Quantity}} +  \frac{\text{n. Unique SICs}}{\text{Total Allowed SICs}}\cdot\frac{1}{1 + \text{MSE
of Industry}}
$$

Where the MSE of stocks/industry is calculated as being the difference between
the actual investment strategy and a perfectly even distribution. For example,
if a player invested 90% of their stocks into tech and 5% into finance and
pharma respectively, their breakdown (and the idea) would be as follows

|        | Tech | Pharma | Fin  |
| ------ | ---- | ------ | ---- |
| Actual | 90   | 5      | 5    |
| Ideal  | 33.3 | 33.3   | 33.3 |

(without the todo) this will be in the range [0, 1]

## Client Satisfaction

Client satisfaction is effectively a measure of risk. The idea here is that the
client will be unhappy if you exceed their risk threshold, and happy if you
don't.

This requires calculating the risk of a portfolio: this is done with standard
deviation of portfolio value with measurements taken each day. This is in the
range $\left[0, \inf\right]$

Then, there is a client risk function which is in the range $\left[0, 1.2\right]$.
This is a combination of client age, employment status, etc. which are all
autogenerated as part of the **context**.

A threshold standard deviation, $\sigma_{threshold}$, is calculated, and points
are docked where a player's portfolio risk exceeds this $\sigma_{\text{threshold}}$.
The threshold standard deviation is calculated using the normalised player risk,
$k$, such that $k = 2 - \frac{\text{player risk}}{1.2}$. The "two minus" term
changes a 1.2 from meaning most risky to least risky, and also shifts $k$ to be
in the range [1, 2].

$$
\sigma_{\text{threshold}} = \mu\cdot|~1-k~|
$$

$\mu$ is the average stock price in the portfolio over the given period.

## Risk-Adjusted Returns

Calculated according to the mean average of the [Sharpe](https://en.wikipedia.org/wiki/Sharpe_ratio) and the [Sortino](https://www.investopedia.com/terms/s/sortinoratio.asp) ratios.

## Drawdown Resilience

We define maximum drawdown (MDD) as the greatest peak-to-trough percentage decline
in cumulative portfolio value over the evaluation window. The drawdown score is:

$$
	ext{DrawdownScore} = 1 - |\text{MDD}|
$$

Thus:
- No drawdown (MDD = 0%) gives a score of 1.0.
- A 30% max drawdown (MDD = -0.30) gives a score of 0.70.
- A 100% drawdown bottoms at 0.0.

If insufficient data points (<2) a neutral score of 0.5 is used. This score is
scaled by an adjustable constant (e.g. `DRAWDOWN_SCALE`) in `main.py`.

Rationale: Incorporating drawdown discourages brittle, high-volatility strategies
that briefly spike returns but expose large downside risk.

## Safety Limits

Two optional configuration values can be set at the top of `prism-evaluation/main.py` to constrain scoring:

- `MAX_STOCKS_LIMIT`: If set to an integer (e.g. 25), only the first N submitted stocks are considered. Any additional stocks beyond this limit are ignored for pricing, profit and diversification.
- `MAX_POINTS_LIMIT`: If set to a number (e.g. 10000), the final points output is capped to the range `[-MAX_POINTS_LIMIT, MAX_POINTS_LIMIT]` after all other adjustments.

Leaving either as `None` disables that particular limit.

## Random Additive Factor

An optional stochastic term can be added to reduce overfitting to fixed weights.
It is sampled uniformly each evaluation from `[RANDOM_MIN, RANDOM_MAX]` and then
multiplied by `RANDOM_SCALE` before inclusion in the total. Set `RANDOM_SCALE = 0`
to disable. You can fix `RANDOM_SEED` for reproducible replay.

This differs from the early override random scoring (which replaces the score).
The additive factor only perturbs the final points.
